!function(){function e(e){return e&&angular.isFunction(e.then)}function i(e){return{add:function(i){var n=angular.copy(e.$modelValue)||[];n.push(i),e.$setViewValue(n)},"delete":function(i){var n=angular.copy(e.$modelValue);n.splice(i,1),e.$setViewValue(n)},deleteByValue:function(i){var n,t;for(n=0;n<e.$modelValue.length;n++)if(angular.equals(e.$modelValue[n],i)){t=n;break}void 0!==t&&this["delete"](t)}}}function n(e,i){var n=this;this.type="defer",this.defer=e,this.isLoading=!1,this.isFailed=!1,i&&(n.isLoading=!0,i.then(function(e){n.defer=e,n.isLoading=!1},function(e){n.defer=e,n.isLoading=!1,n.isFailed=!0}))}function t(e){if(void 0!==e){var i,n;return i=e.indexOf("(")+1,n=e.indexOf(")"),e.substr(i,n-i)}}function r(r,o,c){function a(o,a,u,s,d){if(!o.chipTemplate)throw"should have chip-tmpl";var p,h=i(s),f=u.hasOwnProperty("defer"),v=t(u.render),g=a.find("input")[0];o.chips.addChip=function(i){function t(e){o.chips.list.push(e),h.add(e)}var r,l;void 0!==o.render&&""!==v?(l={},l[v]=i,r=o.render(l)):r=i,e(r)?(r.then(function(e){h.add(e)}),o.chips.list.push(new n(i,r)),o.$apply()):t(r)},o.chips.deleteChip=function(e){if(!(e<0||e>=o.chips.list.length)){var i=o.chips.list[e];if(!o.removeChip||o.removeChip({$chip:i}))return o.chips.list.splice(e,1),i.isFailed?void o.$apply():(i instanceof n?h.deleteByValue(i.defer):h["delete"](e),!0)}},s.$render=function(){if(f&&s.$modelValue){var e,i=[];for(e=0;e<s.$modelValue.length;e++)i.push(new n(s.$modelValue[e]));o.chips.list=i}else o.chips.list=angular.copy(s.$modelValue)||[]},p=angular.element("<div></div>");var m=angular.element(o.chipTemplate);m.attr("ng-repeat","chip in chips.list track by $index"),m.attr("ng-class","{'chip-failed':chip.isFailed}"),m.attr("tabindex","-1"),m.attr("index","{{$index}}"),p.append(m);var C=r(p)(o);a.prepend(C),a.on("click",function(e){"CHIPS"===e.target.nodeName&&g.focus()}),o.chips.handleKeyDown=function(e){function i(i){var t,r=parseInt(e.target.getAttribute("index"));t=r>=0?r:n.length;var l=t+i;l<0?0===o.chips.list.length&&g.focus():l>=n.length?g.focus():n[l].focus()}var n=p.children();if(e.keyCode===l.BACKSPACE){var t=parseInt(e.target.getAttribute("index"));e.target===g&&""===e.target.value?i(-1):e.target.parentElement===p[0]&&o.chips.deleteChip(t)&&i(-1),e.preventDefault()}else e.keyCode===l.LEFT?i(-1):e.keyCode===l.RIGHT&&i(1)},a.on("keydown",o.chips.handleKeyDown),c(a).addClass("chip-out-focus")}return a.$inject=["scope","iElement","iAttrs","ngModelCtrl","transcludefn"],{restrict:"E",scope:{render:"&?",removeChip:"&?"},transclude:!0,require:"ngModel",link:a,controller:"chipsController",controllerAs:"chips",template:"<div ng-transclude></div>"}}function o(e,i,n){this.registerChild=function(i){if(e.chipTemplate)throw"should have only one chip-tmpl";e.chipTemplate=i},this.setFocus=function(e){e?n(i).removeClass("chip-out-focus").addClass("chip-in-focus"):n(i).removeClass("chip-in-focus").addClass("chip-out-focus")},this.removeChip=function(i,n){e.chips.deleteChip(n)}}r.$inject=["$compile","$timeout","DomUtil"],o.$inject=["$scope","$element","DomUtil"],angular.module("angular.chips",[]).directive("chips",r).controller("chipsController",o);var l={BACKSPACE:8,LEFT:37,RIGHT:39}}(),function(){function e(){return{require:"^^chips",transclude:!0,link:function(e,i,n,t,r){r(e,function(e){var n="";angular.forEach(e,function(e){n+=e.outerHTML||""}),t.registerChild(n),i.remove()})}}}angular.module("angular.chips").directive("chipTmpl",e)}(),function(){function e(){return{restrict:"A",require:"^?chips",link:function(e,i,n,t){function r(){"string"!=typeof e.chip&&e.chip.isLoading||t.removeChip(e.chip,e.$index)}i.on("click",function(){r()})}}}angular.module("angular.chips").directive("removeChipButton",e)}(),function(){function e(e){var i={};return i.addClass=function(n){return i.removeClass(e,n),e.attr("class",e.attr("class")+" "+n),i},i.removeClass=function(n){var t=e.attr("class").split(" "),r=t.indexOf(n);return r!==-1&&t.splice(r,1),e.attr("class",t.join(" ")),i},i}angular.module("angular.chips").factory("DomUtil",function(){return e})}(),function(){function e(){return{restrict:"A",require:"^chips",link:i}}function i(e,i,n,t){i.on("keypress",function(e){13===e.keyCode&&""!==e.target.value&&(t.addChip(e.target.value),e.target.value="",e.preventDefault())}),i.on("focus",function(){t.setFocus(!0)}),i.on("blur",function(){t.setFocus(!1)})}i.$inject=["scope","iElement","iAttrs","chipsCtrl"],angular.module("angular.chips").directive("chipControl",e)}(),function(){function e(){return{restrict:"A",require:["ngModel","^chips"],link:function(e,i,n,t){var r=t[0],o=t[1];r.$render=function(e){r.$modelValue&&(o.addChip(r.$modelValue),i.val(""))},i.on("focus",function(){o.setFocus(!0)}),i.on("blur",function(){o.setFocus(!1)})}}}angular.module("angular.chips").directive("ngModelControl",e)}();